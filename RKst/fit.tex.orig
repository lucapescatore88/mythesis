\section{Mass fits}

In this section we describe fits of the 4-body invariant masses $m(K\pi\ell\ell)$.
These are done in order to extract raw yields of the four channels,
which will then be used to build the $R_{\Kstar}$ quantity, as described in sec.\ref{sec:result}.


\subsection{Mass fits: muonic channels}

The $K^{*0}\mu\mu$ we fit the $m(K\pi \mu\mu)$ invariant mass coming from the kinematic fit where all vertices are required to point to their mother particle.
For the $J/\psi$ case there is a further constraint that fixed the $J/\psi$ mass to its nominal value. On the \Bz invarian mass this constraint
has the effect or increasing the resolution on the fit and pushing misreconstructed background away from it.
The mass spectrum is fitted in the range $5150 - 5800 ~\mbox{MeV/c}{^2}$ with the lower limit of the mass range chosen to exclude partially reconstructed background.
 
In order to fit the $B^0 \rightarrow K^{*0}\mu\mu$ (and the relative $J/\psi$ channel) mass spectrum we use a double Crystal Ball function. A Crystal Ball function
(Eq. \ref{CB})\cite{Skwarnicki:1986xj} is a probability density function commonly used to model various processes involving energy loss at low energy.
In particular it is used to model the radiative tail which can be seen in many resonances' peak. This function consists of a Gaussian core and a power-law tail,
below a certain threshold. The function itself and its first derivative are both continuous.

\begin{equation}
C(x;\alpha,n,\bar{x},\sigma) = N \cdot
\begin{cases}
exp \left( -\frac{(x - \bar{x})^2}{2\sigma} \right)  & \mbox{   if   } \frac{(x - \bar{x})}{\sigma} > \alpha \\
A\left( B - \frac{(x - \bar{x})}{\sigma} \right)^{-n} & \mbox{   if   } \frac{(x - \bar{x})}{\sigma} < \alpha
\end{cases}
\end{equation}

where for normalisation and continuity

\begin{equation}
\label{CB}
\begin{array}{ll}
A = \left( \frac{c}{|\alpha|} \right))^n \cdot exp(- \frac{\alpha^2}{2}) \\
B = \frac{n}{|\alpha|} - |\alpha|
\end{array}
\end{equation}

A double Crystal Ball is then given by the sum of two Crystal Balls where the parameters of the tail and the mean are kept in common, so that the only free
parameter added are the $\sigma$ of the second Crystal Ball and the fraction ($f$) of events falling in it.

\begin{equation}
\label{DCB}
D(x;\alpha,n,\bar{x},\sigma_1, \sigma_2, f) = f \cdot C(x;\alpha,n,\bar{x},\sigma_1) + (1 - f) \cdot C(x;\alpha,n,\bar{x},\sigma_2)
\end{equation}

In order to fit the combinatorial background we used an exponential function. For the $B^0 \rightarrow K^{*0}J/\psi(\rightarrow \mu\mu)$ fit
we used the same model adding a double Crystal Ball component to take into account some remaining $B_s \rightarrow K^{*0}J/\psi$, 
which can be clearly seen peaking at the $B_s$ mass in Fig \ref{KstMuMufit}. 
A \Lb\to\jpsi pK cbackground component is added again using the shape from a fully reconstruced MC sample.
In order to obatain a smooth distribtion from the distributions of events which passed all cuts we use the RooKeysPdf class from RooFit.
Finally, in all fits we added a component of residual mis-reconstructed events again modelled using the shape from a Monte Carlo simulation.


First of all we then performed an unbinned maximum likelihood fit on the $\Bz\to K^{*0}J/\psi$ events, the result is reported in Fig. \ref{KstMuMufit}.
In a second step we take the signal parameters from the resonant channel fit and we constrain the model for the rare channel to have the same parameters.
In particular the tail parameters and the central value. Since the resolution could depend on the \qsq region, we leave the resolutions,
$\sigma_1$ and $\sigma_2$, floating, but fixing their ratio to the one found in the resonant case.
This corresponds to leave one resolution floating and re-write the second as:

\begin{equation}
\sigma_2' = \frac{\sigma_2^{J/\psi}}{\sigma_1^{J/\psi}} \cdot \sigma_1 
\end{equation}

In summary the floating variables in the rare channel fit are: the signal and background yields, $\sigma_1$ and the combinatorial background slope.


\begin{figure}[h!]
\label{KstMuMufit}
\centering \includegraphics[width=0.48\textwidth]{figs/Fit/KstMM_fitAndRes.pdf}
\centering \includegraphics[width=0.48\textwidth]{figs/Fit/KstJPsMM_fitAndRes.pdf}
\caption{$B^0$ mass spectrum for $K^{*0}\mu\mu$ events (left) and $K^{*0}J/\psi(\rightarrow \mu\mu)$ (right). Dashed lines represent background components. }
\end{figure}

\begin{figure}[h!]
\label{KstMuMufit}
\centering \includegraphics[width=0.48\textwidth]{figs/Fit/KstMM_log_fitAndRes.pdf}
\centering \includegraphics[width=0.48\textwidth]{figs/Fit/KstJPsMM_log_fitAndRes.pdf}
\caption{$B^0$ mass spectrum for $K^{*0}\mu\mu$ events (left) and $K^{*0}J/\psi(\rightarrow \mu\mu)$ (right). Dashed lines represent background components. }
\end{figure}


\subsection{Mass fits: electronic channels}

In the electronic case the variable we fit is the $m(K\pi ee)$ invariant mass coming from the kinematic fit where all vertices are required to point to their mother particle.
While in the muon case we used a further contrain for the resonant fit, constraing the $J/\psi$ mass to its nominal value,
we do not apply this contrain in the elecontic case. This is because the electronic channel have a much longer tail at low invariant masses
due to breamsstrahlung radiation and applying a contrain on $J/\psi$ mass distorts this tail makeing it diffiult to fit.
 
As for the muonic channels also in the electronic case the signal is modelled with a Double Crystal Ball function and the combinatorial background with an exponential.
However in this case the invarian mass distributions are different depending of which trigger was used and especially how many breamstrhalung photons were reconstructed.

Therefore we divide our sample in: 3 trigger categories and 3 breamstralung categories. The three trigger categores are defined, to be exclusive, in the following way:

\begin{itemize}
\item Events triggered by an electron in the singal candidate: \begin{verbatim} L0E_TOS \end{verbatim}
\item Events triggered by L0Hadron in the signal candidate and not L0Electron: \begin{verbatim} L0H_TOS && !L0E_TOS \end{verbatim}
\item Events triggered by particles not in the singal candiate (Trigger Independent of Signal, TIS) and not by the previous cases: \begin{verbatim} GTIS && (L0E_TOS || L0H_TOS) \end{verbatim}
\end{itemize}

The majority of the selected events falls in the L0E cathegory, triggered byt the electron. 

The three breamstrhalung categories are:

\begin{itemize}
\item $0\gamma$: events with no photon emitted
\item $1\gamma$: events with one photon by either of the electrons
\item $2\gamma$: events with ono photon emitted by each electron
\end{itemize}

The $0\gamma$ caterogy is catacterised by a better resoluton and a sharp tail on the righthand side.

\subsubsection{ Resonant channel fit }

We start fitting the resonant channel using the following steps:

\begin{itemize}
\item Fit $\Bz\to\Kstar\jpsi(ee)$ MC events divided in each category.
The signal is modelled with a simple Crystal Ball in the $0\gamma$ case and with a "Crystal Ball + Gauss" function in the 1 and 2$\gamma$ cases.
\item For each trigger category build a PDF made as the sum of the 3 PDFs for each breamstrhalung categories
\begin{equation}
PDF^t = PDF^t_{0\gamma} + PDF^t_{1\gamma} + PDF^t_{2\gamma}
\end{equation}
\item Use this joint PDF to fit real data divided only by trigger categories.
\end{itemize}

In the first fit on MC events all parameters are left floating.
When we build the joint PDF, $DCB^t$, we fix all tails parameters and masses leaving one single global mass shift to float.
Furthermore the ratio, $\sigma_1/\sigma_2$ is fixed to what is found from the fit on MC data. Finally when constructing the
sum of the three breamsstrahlung components we need to specify in which fractions they contribute to the total.
This franction have been shown to be in good agreement between data and MC and therefore we use the MC itself to define
them and we fix them in the fit. In table \ref{tab:brem_frac} are reported percentages of events with 0, 1 and 2 emitted
photons in the three trigger categories.

\begin{table}
\centering
\begin{tabular}{l|c|c|c}
Trigger 	&	$0 \gamma$	&	$1 \gamma$  &	 $2 \gamma$  \\ \hline
\multicolumn{4}{c}{Resonant case} \\ \hline
L0E			&	29.356 \%	&	50.345 \%	&	20.298 \%	 \\
L0H			&	20.477 \%	&	51.055 \%	&	28.468 \%	 \\
L0I			&	26.005 \% 	&	50.174 \%	&	23.821 \%	 \\ \hline
\multicolumn{4}{c}{Rare case} \\ \hline
L0E			&	33.088 \%	&	47.162 \%	&	19.750 \%	 \\
L0H			&	25.744 \%	&	47.123 \%	&	27.133 \%	 \\
L0I			&	27.674 \% 	&	49.822 \%	&	22.504 \%	 \\
\end{tabular}
\caption{Percentages of events with 0, 1 and 2 emitted photons in the three trigger categories, extracted from MC simulation.}
\label{tab:brem_frac_jpsi}
\end{table}

Then a fit component is added to model the misreconstructed background.
In order to do this we a MC sample which simulates $\Bz\to X\jpsi(ee)$,
where X can be anything excluded a \Kstar. We reconstruct these ecents as if they where \BdKstee events
and we look at the distributions after full selection. We use the invariant mass of these events,
smoothed using the RooKeysPdf class, to model the mis-reconstructed background. Finally, we do the same procedure
with $\Bs\to X\jpsi(ee)$ events. The yield of this component is bounded to the $\Bz\to X\jpsi(ee)$ yield.

In summary in the resonant fit on data the floating parameters are the yields, three sigmas (one per breamsrtahlung
category, one mass shift and the combinatorial background slope.)

In Fig.\ref{fig:FitEE_MC_inTrigCat_Brem0} are reported fits on MC $\Bz\to X\jpsi(ee)$ events for all trigger categories
and no photons emitted, in Fig.\ref{fig:FitEE_MC_inTrigCat_Brem1} for one photom emitted and in
Fig.\ref{fig:FitEE_MC_inTrigCat_Brem2} for two photons emitted. Finally in Fig. \ref{fig:FitJpsiEE_Data_inTrigCat}
are reported fits on real data events in the three trigger categories.

\begin{figure}[h!]
\centering
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_0g_L0E_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_0g_L0H_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_0g_L0I_fitAndRes.pdf}
\caption{Fitted $B^0$ mass spectrum of $B^0 \rightarrow K^{*0} J/\psi(J/\psi\rightarrow ee)$ MC events in the three trigger categories and no photon emitted. }
\label{fig:FitEE_MC_inTrigCat_Brem0}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_1g_L0E_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_1g_L0H_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_1g_L0I_fitAndRes.pdf}
\caption{Fitted $B^0$ mass spectrum of $B^0 \rightarrow K^{*0} J/\psi(J/\psi\rightarrow ee)$ MC events in the three trigger categories and one photon emitted. }
\label{fig:FitEE_MC_inTrigCat_Brem1}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_2g_L0E_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_2g_L0H_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_2g_L0I_fitAndRes.pdf}
\caption{Fitted $B^0$ mass spectrum of $B^0 \rightarrow K^{*0} J/\psi(J/\psi\rightarrow ee)$ MC events in the three trigger categories and two photons emitted. }
\label{fig:FitEE_MC_inTrigCat_Brem2}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_L0E_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_L0H_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstJPsEE_L0I_fitAndRes.pdf}
\caption{Fitted $B^0$ mass spectrum of $B^0 \rightarrow K^{*0} J/\psi(J/\psi\rightarrow ee)$ real data events in the three trigger categories and no photon emitted. }
\label{fig:FitJpsiEE_Data_inTrigCat}
\end{figure}



\subsubsection{ Rare channel fit }

After fitting the resonant channel we can use its information to contrain the fit of the rare channel.
In the rare case the statistics is not enough to constrain many parameters and therefore we need a model dependent only on a few.
For these reasons in the rare case we take the 3 PDFs (in trigger categories) used to fit the resonant channel and we fix all their parameters.
Since the fractions of events with different number of emitted photons could be different in the rare and resonant case,
for the fit on the rare we use the fractions extracted from rare MC sample.

Using such a model for the signal, an exponential for the combinatorial bagkground and {\em add misreco!} we fit the rare data sample.
Results of these fits are reported in Fig. \ref{fig:FitEE_Data_inTrigCat} divided in trigger categories.


\begin{figure}[h!]
\centering
\includegraphics[width=0.40\textwidth]{figs/Fit/KstEE_L0E_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstEE_L0H_fitAndRes.pdf}
\includegraphics[width=0.40\textwidth]{figs/Fit/KstEE_L0I_fitAndRes.pdf}
\caption{Fitted $B^0$ mass spectrum of \BdKstee real data events in the three trigger categories and no photon emitted. }
\label{fig:FitJpsiEE_Data_inTrigCat}
\end{figure}









\clearpage

