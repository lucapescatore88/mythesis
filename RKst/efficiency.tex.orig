\section{Efficiency}
\label{sec:efficiency}


Efficiency for each of the decays is calculated according to the formula
\begin{equation}
\epsilon=\epsilon(Geom)\epsilon(Reco|Geom)\epsilon(PID|Reco)\epsilon(Trig|PID)\epsilon(MVA|Trig).
\end{equation}
In this expression the first term gives efficiency to have final state particles in the LHCb acceptance.
The second term carries information on reconstruction and stripping efficiency
(we keep these together given that boundaries between them are completely artificial). 
The third part handles trigger efficiency for those events which are selected by the preselection process.
Reconstruction trigger and MVA efficiency are evaluated on simulated data with trigger efficiency
for \Bz\to\Kstar\jpsi being cross-checked using the TISTOS method on data.
And finally the last term deals with the efficiency of the Neural Network selection.

While we list all efficiencies for four decays separately including many
systematic uncertainties, for the analysis itself we need only relative efficiency
($\epsilon(\Bz\to\Kstar ee)/\epsilon(\Bz\to\Kstar(\jpsi\to ee))$)/($\epsilon(\Bz\to\Kstar \mumu)/\epsilon(\Bz\to\Kstar(\jpsi\to \mumu))$).
Systematic uncertainties for relative efficiencies take into account that some effects are correlated between two decays.
All efficiencies are calculated using simulated samples generated with Pythia8.

In the tables with relative efficiency is reported also the relative efficiency
$\epsilon(\Bz\to\Kstar \ell\ell/\epsilon(\Bz\to\Kstar(\jpsi\to \ell\ell)$
This should be equal to one in all cases in which the distributions of cutted variables
are sufficiently similar in rare and resonant cases.

In table \ref{tab:AbsEffs} are reported absolute efficiencies
for the electron and muon channels in the \qsq bin $1 < q^2 < 6$ \gevgevcccc.
In table \ref{tab:RelEffs} are reported relative efficiencies
$\epsilon(\Bz\to\Kstar \ell\ell/\epsilon(\Bz\to\Kstar(\jpsi\to \ell\ell)$ and finally
in table \ref{tab:DoubleRelEffs} are reported double relative $(ee/(\jpsi \to ee)/(\mumu/(\jpsi\to \mumu)$
again in the same \qsq bin. In particular the latter table contains the total double-relative
efficiency, $\epsilon_tot^{DRel} = \pm $, which is used for the final result extraction.

\begin{table}
\centering
\begin{tabular}{l|cc|cc} \hline\hline
Eff. & $ee$ & \mumu \\ \hline
\hline
%Geom 	&  	&    \\
%Reco 	&  $0.0372 +- 0.0002$ &  $0.0439 +- 0.0001$ & $0.75671 \pm 0.01144$  \\
%PID 	&  $83.69 +- 0.02$	  &  $84.07 +- 0.01$    & \\
%Trig 	&  $0.58674 \pm 0.00671$	&  $0.77757 \pm 0.01053$  \\
%MVA 	&  $0.90381 \pm 0.00561$	&  $0.94811 \pm 0.00781$  \\ \hline
%Total	&  $$	&  $$  \\
\hline
\end{tabular}
\caption{Absolute efficiencies for $ee$ and \mumu channels in the $1 < q^2 < 6$ \gevgevcccc \qsq bin.}
\label{tab:AbsEff}
\end{table}

\begin{table}
\centering
\begin{tabular}{l|cc|cc} \hline\hline
Eff. & $ee$ & \mumu \\ \hline
\hline
%Geom 	&  	&    \\
%Reco 	&  $0.0372 +- 0.0002$ &  $0.0439 +- 0.0001$ & $0.75671 \pm 0.01144$  \\
%PID 	&  $83.69 +- 0.02$	  &  $84.07 +- 0.01$    & \\
%Trig 	&  $0.58674 \pm 0.00671$	&  $0.77757 \pm 0.01053$  \\
%MVA 	&  $0.90381 \pm 0.00561$	&  $0.94811 \pm 0.00781$  \\ \hline
%Total	&  $$	&  $$  \\
\hline
\end{tabular}
\caption{Relative efficiencies for $ee$ and \mumu channels in the $1 < q^2 < 6$ \gevgevcccc \qsq bin.}
\label{tab:RelEff}
\end{table}



\subsection{Reconstruction and stripping efficiency}

The efficiency to reconstruct our decays together with the stripping selection is
evaluated from simulated data. This component does not include the efficiency
of the PID cuts, because PID is known to be not well simulated and therefore we use a
data driven method for this part (see \ref{sec:PIDeff}).



\subsection{PID efficiency}
\label{sec:PIDeff}
The MC is known not to describe particle ID well
and therefore we use a data driven method to obtain this efficiency component.
Furthermore we use the same method to weight the MC in order to extract MVA and trigger efficiencies.

In order to do this we used the PIDCalib package. This package uses decays where particles
can be identified due to their kinematic properties.
%In our case a sample of $\Lz$ particles was used where the proton can be identified because it always has the highest momentum {\em check!}.

Then the package allows to divide the phase-space in bins (momentum and pseudorapidity) and
reweight the efficiencies found to take in account that the decay channel under study
could have different kinematical distributions than the calibration sample.

On efficiency table is obtained for each particle and the total efficiency for the event is calculated as
the product of the four final particles efficiencies. $\epsilon^{ev} = \epsilon_K\cdot\epsilon_\pi\cdot\epsilon_{\ell_1}\cdot\epsilon_{\ell_2}$.
Finally, the total efficiency is found by averaging over all MC events.

\begin{equation}
\epsilon_{PID} = \frac{1}{N} \sum_i^N \epsilon_K(p_K^i,\eta_K^i) \cdot \epsilon_\pi(p_\pi^i,\eta_\pi^i) \cdot \epsilon_\ell(p_{\ell_1}^i,\eta_{\ell_1}^i) \cdot \epsilon_K(p_{\ell_2}^i,\eta_{\ell_2}^i)
\end{equation}


\subsection{Neural Networks efficiency}

The MVA efficiency is again evaluated from weighted MC samples. 
Results are shown in table \ref{tab:mvaEff} in bins of \qsq. The error shown is due to to MC statistics. 

\subsection{Trigger efficiency}
\label{sec:trigger}

\subsubsection{Muonic channels}

For the muonic channels the trigger efficiency is calculated using simulated events,
following same logic as previous two efficiencies. %The pre-scale emulator tool in DaVinci is also used.
We calculate this efficiency for events which are accepted by the full selection.

Using the resonant channel we crosschecked the efficiency obtained using the MC simulation with the data driven TISTOS method.
In LHCb triggered events can fall in two categories: events triggered by a track which is part
of the decay of interest, Trigger On Signal (TOS), or by other tracks in the events,
Trigger Independent of Signal (TIS). All trigger lines used for this analysis are required to be TOS.
The efficiency for TOS trigger can be obtained by data by the following formula:
\begin{equation}
\epsilon_{TOS} = \frac{TOS \mbox{ and } TIS}{TIS}
\end{equation}

{\em Results of TISTOS}

%For 2011 we use the official 0x40760037 TCK, corresponding to 0.944 \invfb of data.
%For 2012 the official TCK is 0x409f0045 describes only data after the June technical stop (1.442 \invfb).
Samples with different TCKs are weighted to respect the percentage of luminosity taken with each configuration.

\subsubsection{Electronic channels}

For the electronic channels data is fitted separately in three trigger categories: L0Electron, L0Hadon and L0TIS.
Therefore we need to extact the efficiency separately for each category.

While the Hlt (1 and 2) efficiency is still cmputed using MC the L0 efficiency is
found using data-driven efficiency tables, made using the TIS-TOS method.
For each trigger category these tables contain efficiency as a function of
$p_T$ and differentiating among calorimeter regions. 
Regions considered are inner and outer HCAL, and inner, middle and outer ECAL.

The probability of L0Hadron trigger is calculated for each event as $P_{L0Had} = \epsilon(\pi) + \epsilon(K) - \epsilon(\pi)\epsilon(K)$.
Similarly the L0Electron trigger probability is $P_{L0Ele} = \epsilon(e^+) + \epsilon(e^-) - \epsilon(e^+)\epsilon(e^-)$.
Notice that no weight $P_{L0TIS}$ can be defined using the TIS-TOS technique. On the other hand
the probability of TIS trigger is defined to be independent of the signal and thereofre must be the same in the rare and resonant channel.

Then weights for the three trigger categories are then defined to be exclusive in the following way:

\begin{itemize}
\item L0ElectronTOS: $\epsilon^{L0E} = P_{L0Ele}$,
\item L0HadronTOS: $\epsilon^{L0H} = P_{L0Had}\cdot(1 - P_{L0Ele})$, namely the probability that one hadron triggered but none of the electrons,
\item L0TIS: $\epsilon^{L0I} = (1-P_{L0Had})\cdot(1 - P_{L0Ele})$, namely the probability that neither the hadrons or the electrons in the event triggered.
\end{itemize}

The total efficiency for each category is then found by using the kinematic distribution from MC events,
weighted for PID efficiencies, SPD and \Bz $p_T$ as described in \ref{sec:MCweighting}.
Therefore, as in the PID case, the efficency is found averaging over all MC events:

\begin{equation}
\epsilon^{cat} = \frac{1}{N} \sum_i^N \epsilon^{cat}(p_T^i)
\end{equation}

where $cat$ is a label indicating the trigger category under consideration.





\clearpage








